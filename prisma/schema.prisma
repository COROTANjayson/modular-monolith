generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model User {
    id                       String    @id @default(uuid())
    firstName                String?
    lastName                 String?
    email                    String    @unique
    password                 String
    age                      Int?
    gender                   String?
    createdAt                DateTime  @default(now())
    updatedAt                DateTime  @updatedAt
    // For refresh token rotation using JTI approach:
    currentTokenId           String?
    isVerified               Boolean   @default(false)
    verificationToken        String?   @unique
    verificationTokenExpires DateTime?

    organizationMembers OrganizationMember[]
}

model Organization {
    id      String @id @default(cuid())
    name    String
    slug    String @unique
    ownerId String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    members     OrganizationMember[]
    invitations OrganizationInvitation[]
}

model OrganizationMember {
    id             String                   @id @default(cuid())
    organizationId String
    userId         String
    role           OrganizationRole
    status         OrganizationMemberStatus

    invitedAt DateTime  @default(now())
    joinedAt  DateTime?

    organization Organization @relation(fields: [organizationId], references: [id])
    user         User         @relation(fields: [userId], references: [id])

    @@unique([organizationId, userId])
}

model OrganizationInvitation {
    id             String           @id @default(cuid())
    organizationId String
    inviterId      String
    email          String
    role           OrganizationRole
    token          String           @unique

    expiresAt  DateTime
    acceptedAt DateTime?

    createdAt DateTime @default(now())

    organization Organization @relation(fields: [organizationId], references: [id])
}

enum OrganizationRole {
    owner
    admin
    member
}

enum OrganizationMemberStatus {
    invited
    active
    suspended
    left
}
